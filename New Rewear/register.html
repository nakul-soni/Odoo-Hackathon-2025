
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title data-i18n="register_title">Register - ReWear</title>
    <link rel="stylesheet" href="style.css">
</head>
<body class="auth-bg">
    <!-- Header -->
    <header>
        <div class="logo" data-i18n="logo"><strong>ReWear</strong></div>
        <nav>
            <a href="index.html" data-i18n="nav_home">Home</a>
            <a href="browse.html" data-i18n="nav_browse">Browse</a>
            <a href="dashboard.html" data-i18n="nav_dashboard">Dashboard</a>
            <a href="admin-login.html" class="admin-link">üë®‚Äçüíº Admin</a>
        </nav>
        <div class="theme-toggle">
            <button id="themeToggle" aria-label="Toggle theme">
                <span class="light-icon">‚òÄÔ∏è</span>
                <span class="dark-icon">üåô</span>
            </button>
        </div>
    </header>

    <div class="auth-container">
        <div class="auth-card">
            <div class="auth-logo">
                <div class="logo-circle">
                    <span style="font-size:2.5rem;">üëï</span>
                </div>
            </div>
            <h2 data-i18n="register_welcome">Join ReWear</h2>
            <p class="auth-subtitle" data-i18n="register_subtitle">Create your account and start your sustainable fashion journey</p>
            
            <!-- Registration Form -->
            <form class="auth-form" id="registerForm">
                <div class="form-group">
                    <label for="name" data-i18n="register_fullname">Full Name</label>
                    <input type="text" id="name" name="fullName" placeholder="Enter your full name" required>
                    <div class="input-icon">üë§</div>
                </div>

                <div class="form-group">
                    <label for="email" data-i18n="register_email">Email Address</label>
                    <input type="email" id="email" name="email" placeholder="Enter your email" required>
                    <div class="input-icon">üìß</div>
                </div>

                <div class="form-group">
                    <label for="mobile" data-i18n="register_mobile">Mobile Number</label>
                    <input type="tel" id="mobile" name="mobile" placeholder="Enter your mobile number" required>
                    <div class="input-icon">üì±</div>
                </div>

                <div class="form-group">
                    <label for="password" data-i18n="register_password">Password</label>
                    <input type="password" id="password" name="password" placeholder="Create a strong password" required>
                    <div class="input-icon">üîí</div>
                    <button type="button" class="toggle-password" aria-label="Toggle password visibility">üëÅÔ∏è</button>
                </div>

                <div class="form-group">
                    <label for="confirmPassword" data-i18n="register_confirm">Confirm Password</label>
                    <input type="password" id="confirmPassword" name="confirmPassword" placeholder="Confirm your password" required>
                    <div class="input-icon">üîí</div>
                    <button type="button" class="toggle-password" aria-label="Toggle password visibility">üëÅÔ∏è</button>
                </div>

                <div class="form-options">
                    <label class="checkbox-container">
                        <input type="checkbox" id="terms" name="terms" required>
                        <span class="checkmark"></span>
                        <span data-i18n="register_terms">I agree to the Terms & Conditions</span>
                    </label>
                    <label class="checkbox-container">
                        <input type="checkbox" id="newsletter" name="newsletter">
                        <span class="checkmark"></span>
                        <span data-i18n="register_newsletter">Subscribe to newsletter</span>
                    </label>
                </div>

                <button type="submit" class="auth-btn primary-btn" data-i18n="register_button">
                    <span class="btn-text">Create Account</span>
                    <span class="btn-loader" style="display:none;">‚è≥</span>
                </button>
            </form>

            <div class="divider">
                <span data-i18n="register_or">or</span>
            </div>

            <div class="social-login">
                <button class="social-btn google-btn" type="button">
                    <span class="social-icon">üîç</span>
                    <span data-i18n="register_google">Sign up with Google</span>
                </button>
                <button class="social-btn facebook-btn" type="button">
                    <span class="social-icon">üìò</span>
                    <span data-i18n="register_facebook">Sign up with Facebook</span>
                </button>
            </div>

            <div class="auth-links">
                <span data-i18n="register_have_account">Already have an account?</span>
                <a href="login.html" class="register-link" data-i18n="register_login">Sign In</a>
            </div>
        </div>
    </div>

    <!-- OTP Verification Modal -->
    <div id="otpModal" class="modal" style="display:none;">
        <div class="modal-content auth-modal">
            <div class="otp-header">
                <h3 data-i18n="otp_title">Verify Your Mobile</h3>
                <p data-i18n="otp_subtitle">We've sent a 6-digit code to your mobile number</p>
            </div>
            <form id="otp-form" class="otp-form">
                <div class="otp-inputs">
                    <input type="text" maxlength="1" class="otp-input" data-index="0">
                    <input type="text" maxlength="1" class="otp-input" data-index="1">
                    <input type="text" maxlength="1" class="otp-input" data-index="2">
                    <input type="text" maxlength="1" class="otp-input" data-index="3">
                    <input type="text" maxlength="1" class="otp-input" data-index="4">
                    <input type="text" maxlength="1" class="otp-input" data-index="5">
                </div>
                <div class="otp-actions">
                    <button type="submit" class="auth-btn primary-btn" data-i18n="otp_verify">Verify OTP</button>
                    <button type="button" class="resend-btn" data-i18n="otp_resend">Resend Code</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Success Modal -->
    <div id="successModal" class="modal" style="display:none;">
        <div class="modal-content auth-modal">
            <div class="success-animation">
                <div class="checkmark-circle">‚úì</div>
            </div>
            <h3 data-i18n="register_success_title">Welcome to ReWear!</h3>
            <p data-i18n="register_success_msg">Your account has been created successfully. Redirecting to your dashboard...</p>
        </div>
    </div>

    <script src="translations.js"></script>
    <script src="script.js"></script>
    <script src="auth.js"></script>
    <script src="theme.js"></script>
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
    <script src="firebase-config.js"></script>
    
    <script>
    // Register page functionality
    document.addEventListener('DOMContentLoaded', function() {
        // Wait for Firebase to be available
        function waitForFirebase() {
            if (typeof firebase !== 'undefined' && window.firebaseAuth) {
                initializeRegister();
            } else {
                setTimeout(waitForFirebase, 100);
            }
        }
        
        function initializeRegister() {
            const registerForm = document.getElementById('registerForm');
            const successModal = document.getElementById('successModal');
            const langSelect = document.getElementById('langSelect');
            const googleBtn = document.querySelector('.google-btn');
            const facebookBtn = document.querySelector('.facebook-btn');

            // Get Firebase auth instance
            const auth = window.firebaseAuth;
            
            // Debug: Check if Firebase is loaded
            if (!auth) {
                console.error('Firebase auth is not available');
                alert('Firebase authentication is not available. Please check your internet connection and try again.');
                return;
            }

            console.log('Firebase auth initialized:', auth);

            // Check if user is already logged in
            auth.onAuthStateChanged(function(user) {
                if (user) {
                    // User is signed in - but don't redirect automatically
                    // Only redirect if they came from a successful registration
                    console.log('User is already signed in:', user);
                }
            });

            // Email/Password Registration
            registerForm.addEventListener('submit', function(e) {
                e.preventDefault();
                
                const name = document.getElementById('name').value;
                const email = document.getElementById('email').value;
                const password = document.getElementById('password').value;
                const confirmPassword = document.getElementById('confirmPassword').value;
                
                // Basic validation
                if (password !== confirmPassword) {
                    alert('Passwords do not match');
                    return;
                }
                
                if (password.length < 6) {
                    alert('Password must be at least 6 characters long');
                    return;
                }
                
                // Show loading state
                const submitBtn = registerForm.querySelector('button[type="submit"]');
                const btnText = submitBtn.querySelector('.btn-text');
                const btnLoader = submitBtn.querySelector('.btn-loader');
                const originalText = btnText.textContent;
                
                btnText.textContent = 'Creating account...';
                btnLoader.style.display = 'inline-block';
                submitBtn.disabled = true;
                
                // Firebase email/password registration
                auth.createUserWithEmailAndPassword(email, password)
                    .then((userCredential) => {
                        const user = userCredential.user;
                        
                        // Update user profile with display name
                        return user.updateProfile({
                            displayName: name
                        });
                    })
                    .then(() => {
                        console.log('Registration successful');
                        
                        // Get the updated user
                        const user = auth.currentUser;
                        
                        // Create user data for auth system
                        const userData = {
                            id: user.uid,
                            name: user.displayName || user.email.split('@')[0],
                            email: user.email,
                            registrationTime: new Date().toISOString()
                        };
                        
                        // Store user data in localStorage for auth system
                        localStorage.setItem('userData', JSON.stringify(userData));
                        localStorage.setItem('loginTime', Date.now().toString());
                        
                        // Show success modal
                        successModal.style.display = 'block';
                        
                        // Redirect to dashboard after a short delay
                        setTimeout(() => {
                            window.location.href = 'dashboard.html';
                        }, 1500);
                    })
                    .catch((error) => {
                        console.error('Registration error:', error);
                        
                        // Reset button state
                        btnText.textContent = originalText;
                        btnLoader.style.display = 'none';
                        submitBtn.disabled = false;
                        
                        // Show error message
                        let errorMessage = 'Registration failed. Please try again.';
                        switch (error.code) {
                            case 'auth/email-already-in-use':
                                errorMessage = 'An account with this email already exists.';
                                break;
                            case 'auth/invalid-email':
                                errorMessage = 'Please enter a valid email address.';
                                break;
                            case 'auth/weak-password':
                                errorMessage = 'Password is too weak. Please choose a stronger password.';
                                break;
                            case 'auth/operation-not-allowed':
                                errorMessage = 'Email/password accounts are not enabled.';
                                break;
                        }
                        alert(errorMessage);
                    });
            });

            // Google Sign-In
            googleBtn.addEventListener('click', function() {
                const provider = new firebase.auth.GoogleAuthProvider();
                
                // Show loading state
                const originalText = this.querySelector('span:last-child').textContent;
                this.querySelector('span:last-child').textContent = 'Signing up...';
                this.disabled = true;
                
                auth.signInWithPopup(provider)
                    .then((result) => {
                        // Success - user is automatically signed in
                        const user = result.user;
                        console.log('Google sign-up successful:', user);
                        
                        // Create user data for auth system
                        const userData = {
                            id: user.uid,
                            name: user.displayName || user.email.split('@')[0],
                            email: user.email,
                            registrationTime: new Date().toISOString()
                        };
                        
                        // Store user data in localStorage for auth system
                        localStorage.setItem('userData', JSON.stringify(userData));
                        localStorage.setItem('loginTime', Date.now().toString());
                        
                        // Show success modal
                        successModal.style.display = 'block';
                        
                        // Redirect to dashboard after a short delay
                        setTimeout(() => {
                            window.location.href = 'dashboard.html';
                        }, 1500);
                    })
                    .catch((error) => {
                        console.error('Google sign-up error:', error);
                        
                        // Reset button state
                        this.querySelector('span:last-child').textContent = originalText;
                        this.disabled = false;
                        
                        // Show error message
                        let errorMessage = 'Google sign-up failed. Please try again.';
                        if (error.code === 'auth/popup-closed-by-user') {
                            errorMessage = 'Sign-up was cancelled.';
                        } else if (error.code === 'auth/popup-blocked') {
                            errorMessage = 'Sign-up popup was blocked. Please allow popups and try again.';
                        } else if (error.code === 'auth/account-exists-with-different-credential') {
                            errorMessage = 'An account already exists with this email using a different sign-in method.';
                        }
                        alert(errorMessage);
                    });
            });

            // Facebook Sign-In (placeholder - requires Facebook app setup)
            facebookBtn.addEventListener('click', function() {
                alert('Facebook sign-up is not configured yet. Please use email/password or Google sign-up.');
            });

            // Close modal and redirect
            document.querySelector('.modal-close').addEventListener('click', function() {
                successModal.style.display = 'none';
            });

            // Close modal when clicking outside
            successModal.addEventListener('click', function(e) {
                if (e.target === successModal) {
                    successModal.style.display = 'none';
                }
            });

            // Password toggle functionality
            const togglePasswordBtns = document.querySelectorAll('.toggle-password');
            togglePasswordBtns.forEach(btn => {
                btn.addEventListener('click', function() {
                    const input = this.previousElementSibling;
                    const type = input.getAttribute('type') === 'password' ? 'text' : 'password';
                    input.setAttribute('type', type);
                    this.textContent = type === 'password' ? 'üëÅÔ∏è' : 'üôà';
                });
            });

            // Password confirmation validation
            const passwordInput = document.getElementById('password');
            const confirmPasswordInput = document.getElementById('confirmPassword');
            
            function validatePasswords() {
                if (confirmPasswordInput.value && passwordInput.value !== confirmPasswordInput.value) {
                    confirmPasswordInput.style.borderColor = '#f44336';
                } else {
                    confirmPasswordInput.style.borderColor = '#e0e0e0';
                }
            }
            
            if (passwordInput && confirmPasswordInput) {
                passwordInput.addEventListener('input', validatePasswords);
                confirmPasswordInput.addEventListener('input', validatePasswords);
            }

            // Language switching
            if (langSelect) {
                langSelect.addEventListener('change', function() {
                    const lang = this.value;
                    translatePage(lang);
                });
            }

            function translatePage(lang) {
                const dict = window.translations[lang] || window.translations['en'];
                document.querySelectorAll('[data-i18n]').forEach(el => {
                    const key = el.getAttribute('data-i18n');
                    if(dict[key]) {
                        if(el.tagName.toLowerCase() === 'title') {
                            document.title = dict[key];
                        } else {
                            el.textContent = dict[key];
                        }
                    }
                });
            }

            // Initialize with English
            translatePage('en');
        }
        
        // Start waiting for Firebase
        waitForFirebase();
    });
    </script>
</body>
</html> 